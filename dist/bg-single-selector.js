define(["angular"],function(e){var t=e.module("bg.selector",[]);t.directive("bgSelector",["$document","$parse",function(t,l){var n=function(e,t){t=t||[];for(var l=t.length,n=0;l>n;n++){var o=t[n];if(o===e)return!0}return!1};return{scope:{},controller:["$scope","$element","$attrs","$transclude",function(e,t,l,n){var o=this;o.options=[],o.open=!1,o.hideChoiceList=function(){o.open=!1},o.toggleChoiceList=function(){o.open=!o.open},o.setSelectorLabel=function(e){o.label=e},o.addOption=function(e){o.options.push(e)}}],controllerAs:"selector",require:["bgSelector","ngModel"],restrict:"E",template:function(e,t){t.ngModel;return'<div class="bg-selector-container"><div class="bg-selector-bar"><div class="bg-selector-content" ng-bind-template="{{selector.label}}"></div><div class="bg-selector-icon" ng-class="{true: \'open\'}[selector.open]"></div></div><div class="bg-choice-list" ng-show="selector.open"></div></div>'},replace:!0,transclude:!0,link:function(o,c,a,i,r){var s=i[0],u=i[1],b=a.placeholder||"请选择",p=e.element(c[0].querySelector(".bg-choice-list")),d=e.element(c[0].querySelector(".bg-selector-bar"));s.onSelectCallback=l(a.onSelect)(o.$parent),d.bind("click",function(e){s.toggleChoiceList(),o.$apply(),e.stopPropagation()}),t.bind("click",function(e){s.open&&s.hideChoiceList(),o.$apply()}),o.$parent.$watch(a.ngModel,function(e){n(e,s.options)?o.$broadcast("bgs:change",e):s.setSelectorLabel(b)}),s.setValue=function(e,t){u.$setViewValue(e),s.setSelectorLabel(t)},s.getValue=function(){return u.$modelValue},s.clearValue=function(){u.$setViewValue(null),s.setSelectorLabel(b)},r(function(e){p.append(e)}),s.setSelectorLabel(b)}}}]),t.directive("bgOption",["$parse",function(t){return{priority:-1,controller:["$scope","$element","$attrs","$transclude",function(e,l,n,o){var c=this;c.value=t(n.value)(e),c.label=t(n.label)(e)}],controllerAs:"option",require:["bgOption","^bgSelector"],restrict:"E",template:'<div class="bg-selector-choice"></div>',replace:!0,transclude:!0,link:function(t,l,n,o,c){var a=o[0],i=o[1];l.bind("click",function(){var e=a.value,t=a.label;t||(t="请选择"),i.setValue(e,t),i.hideChoiceList(),i.onSelectCallback&&i.onSelectCallback(e,t)}),e.equals(a.value,i.getValue())&&i.setSelectorLabel(a.label),t.$on("bgs:change",function(e,t){t===a.value&&i.setSelectorLabel(a.label)}),i.addOption(a.value),t.$watch(n.value,function(e,t){t&&e!==t&&(a.value=e,i.clearValue())}),t.$watch(n.label,function(e,t){t&&e!==t&&(a.label=e,i.clearValue())}),c(function(e){l.append(e)})}}}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJnLXNpbmdsZS1zZWxlY3Rvci5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJhbmd1bGFyIiwiYmdzIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiJGRvY3VtZW50IiwiJHBhcnNlIiwiaXNFeGlzdCIsInZhbHVlIiwib3B0aW9ucyIsImxlbmd0aCIsImkiLCJ0ZW1wIiwic2NvcGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkdHJhbnNjbHVkZSIsImN0cmwiLCJ0aGlzIiwib3BlbiIsImhpZGVDaG9pY2VMaXN0IiwidG9nZ2xlQ2hvaWNlTGlzdCIsInNldFNlbGVjdG9yTGFiZWwiLCJsYWJlbCIsImFkZE9wdGlvbiIsInB1c2giLCJjb250cm9sbGVyQXMiLCJyZXF1aXJlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZSIsImlFbG0iLCJpQXR0cnMiLCJuZ01vZGVsIiwicmVwbGFjZSIsInRyYW5zY2x1ZGUiLCJsaW5rIiwiY3RybHMiLCJ0cmFuc2NsdWRlRm4iLCJzZWxlY3RvciIsInBsYWNlaG9sZGVyIiwiY2hvaWNlTGlzdCIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2VsZWN0b3JCYXIiLCJvblNlbGVjdENhbGxiYWNrIiwib25TZWxlY3QiLCIkcGFyZW50IiwiYmluZCIsImUiLCIkYXBwbHkiLCJzdG9wUHJvcGFnYXRpb24iLCIkd2F0Y2giLCIkYnJvYWRjYXN0Iiwic2V0VmFsdWUiLCIkc2V0Vmlld1ZhbHVlIiwiZ2V0VmFsdWUiLCIkbW9kZWxWYWx1ZSIsImNsZWFyVmFsdWUiLCJjbG9uZSIsImFwcGVuZCIsInByaW9yaXR5IiwiYmdPcHRpb24iLCJiZ1NlbGVjdG9yIiwiZXF1YWxzIiwiJG9uIiwiZXZlbnQiLCJuZXdWYWx1ZSIsIm9sZFZhbHVlIl0sIm1hcHBpbmdzIjoiQUFLQUEsUUFBUSxXQUFZLFNBQVVDLEdBQzFCLEdBQUlDLEdBQU1ELEVBQVFFLE9BQU8saUJBRXpCRCxHQUFJRSxVQUFVLGNBQWUsWUFBYSxT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V1QsU0FBUy9DLEVBQU9pQixHQUMzQnVDLEVBQVcxQyxpQkFFUDBDLEVBQVdsQixrQkFDWGtCLEVBQVdsQixpQkFBaUJ0QyxFQUFPaUIsS0FHdkN4QixFQUFRZ0UsT0FBT0YsRUFBU3ZELE1BQU93RCxFQUFXUCxhQUMxQ08sRUFBV3hDLGlCQUFpQnVDLEVBQVN0QyxPQUl6Q1YsRUFBT21ELElBQUksYUFBYyxTQUFVQyxFQUFPM0QsR0FDbENBLElBQVV1RCxFQUFTdkQsT0FDbkJ3RCxFQUFXeEMsaUJBQWlCdUMsRUFBU3RDLFNBRzdDdUMsRUFBV3RDLFVBQVVxQyxFQUFTdkQsT0FDOUJPLEVBQU9zQyxPQUFPcEIsRUFBT3pCLE1BQU8sU0FBVTRELEVBQVVDLEdBQ3hDQSxHQUFZRCxJQUFhQyxJQUN6Qk4sRUFBU3ZELE1BQVE0RCxFQUNqQkosRUFBV0wsZ0JBR25CNUMsRUFBT3NDLE9BQU9wQixFQUFPUixNQUFPLFNBQVUyQyxFQUFVQyxHQUN4Q0EsR0FBWUQsSUFBYUMsSUFDekJOLEVBQVN0QyxNQUFRMkMsRUFDakJKLEVBQVdMLGdCQUduQnBCLEVBQWEsU0FBVXFCLEdBQ25CNUIsRUFBSzZCLE9BQU9EIiwiZmlsZSI6ImJnLXNpbmdsZS1zZWxlY3Rvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZSDljZXpgInkuIvmi4nmoYbnu4Tku7ZcclxuICogQGF1dGhvciBsYWtiMjQ4QGdtYWlsLmNvbVxyXG4gKi9cclxuXHJcbmRlZmluZShbJ2FuZ3VsYXInXSwgZnVuY3Rpb24gKGFuZ3VsYXIpIHtcclxuICAgIHZhciBiZ3MgPSBhbmd1bGFyLm1vZHVsZSgnYmcuc2VsZWN0b3InLCBbXSk7XHJcblxyXG4gICAgYmdzLmRpcmVjdGl2ZSgnYmdTZWxlY3RvcicsIFsnJGRvY3VtZW50JywgJyRwYXJzZScsIGZ1bmN0aW9uICgkZG9jdW1lbnQsICRwYXJzZSkge1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiB3aGV0aGVyIHRoZSB2YWx1ZSBleGlzdCBpbiB0aGUgb3B0aW9uc1xyXG4gICAgICAgICAqIEBhdXRob3IgbGFrYjI0OEBnbWFpbC5jb21cclxuICAgICAgICAgKiBAcGFyYW0gIHtzdHJpbmd9ICB2YWx1ZSAgIHRoZSB2YWx1ZVxyXG4gICAgICAgICAqIEBwYXJhbSAge3N0cmluZ30gIG9wdGlvbnMgdGhlIG9wdGlvbnNcclxuICAgICAgICAgKiBAcmV0dXJuIHtib29sZWFufSByZXR1bHQgIHRoZSByZXN1bHRcclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgaXNFeGlzdCA9IGZ1bmN0aW9uICh2YWx1ZSwgb3B0aW9ucykge1xyXG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IG9wdGlvbnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBvcHRpb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXAgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gUnVucyBkdXJpbmcgY29tcGlsZVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7fSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogW1xyXG4gICAgICAgICAgICAgICAgJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCAnJHRyYW5zY2x1ZGUnLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJHRyYW5zY2x1ZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5vcHRpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5vcGVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBjaG9pY2UgbGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuaGlkZUNob2ljZUxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9nZ2xlIHRoZSBzdGF0dXMgb2YgY2hvaWNlIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnRvZ2dsZUNob2ljZUxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3BlbiA9ICFjdHJsLm9wZW47XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIGxhYmVsIG9mIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZXRTZWxlY3RvckxhYmVsID0gZnVuY3Rpb24gKGxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwubGFiZWwgPSBsYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuYWRkT3B0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3B0aW9ucy5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3NlbGVjdG9yJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogWydiZ1NlbGVjdG9yJywgJ25nTW9kZWwnXSxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6IGZ1bmN0aW9uIChpRWxtLCBpQXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtb2RlbE5hbWUgPSBpQXR0cnMubmdNb2RlbDtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWNvbnRhaW5lclwiPidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWJhclwiPidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1jb250ZW50XCIgbmctYmluZC10ZW1wbGF0ZT1cInt7c2VsZWN0b3IubGFiZWx9fVwiPjwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1pY29uXCIgbmctY2xhc3M9XCJ7dHJ1ZTogXFwnb3BlblxcJ31bc2VsZWN0b3Iub3Blbl1cIj48L2Rpdj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLWNob2ljZS1saXN0XCIgbmctc2hvdz1cInNlbGVjdG9yLm9wZW5cIj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBpRWxtLCBpQXR0cnMsIGN0cmxzLCB0cmFuc2NsdWRlRm4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RvciA9IGN0cmxzWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5nTW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlciA9IGlBdHRycy5wbGFjZWhvbGRlciB8fCAn6K+36YCJ5oupJztcclxuICAgICAgICAgICAgICAgIHZhciBjaG9pY2VMaXN0ID0gYW5ndWxhci5lbGVtZW50KGlFbG1bMF0ucXVlcnlTZWxlY3RvcignLmJnLWNob2ljZS1saXN0JykpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yQmFyID0gYW5ndWxhci5lbGVtZW50KGlFbG1bMF0ucXVlcnlTZWxlY3RvcignLmJnLXNlbGVjdG9yLWJhcicpKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLm9uU2VsZWN0Q2FsbGJhY2sgPSAkcGFyc2UoaUF0dHJzLm9uU2VsZWN0KSgkc2NvcGUuJHBhcmVudCk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RvckJhci5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IudG9nZ2xlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyBiaW5kIGNsaWNrIGV2ZW50IHRvIGhpZGUgdGhlIGNob2ljZSBsaXN0IHdoZW4gZG9jdW1lbnQgY2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgJGRvY3VtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3Iub3Blbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5oaWRlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHdhdGNoIG5nTW9kZWwgdG8gc2V0IHRoZSBsYWJlbFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQuJHdhdGNoKGlBdHRycy5uZ01vZGVsLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRXhpc3QodmFsdWUsIHNlbGVjdG9yLm9wdGlvbnMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdiZ3M6Y2hhbmdlJywgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICogc2V0IHZhbHVlIGFuZCBsYWJlbCBvZiB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSB0aGUgdmFsdWUgdG8gc2V0XHJcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGFiZWwgdGhlIGxhYmVsIHRvIHNldFxyXG4gICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvci5zZXRWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgbGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwobGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICAgICAqIGdldCB0aGUgdmFsdWUgb2YgdGhlIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHRoZSB2YWx1ZSBvZiB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3IuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5nTW9kZWwuJG1vZGVsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICogY2xlYXIgdGhlIHZhbHVlIG9mIHRoZSBzZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvci5jbGVhclZhbHVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKHBsYWNlaG9sZGVyKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdHJhbnNjbHVkZUZuKGZ1bmN0aW9uIChjbG9uZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNob2ljZUxpc3QuYXBwZW5kKGNsb25lKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChwbGFjZWhvbGRlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xyXG5cclxuICAgIGJncy5kaXJlY3RpdmUoJ2JnT3B0aW9uJywgWyckcGFyc2UnLCBmdW5jdGlvbiAoJHBhcnNlKSB7XHJcbiAgICAgICAgLy8gUnVucyBkdXJpbmcgY29tcGlsZVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHByaW9yaXR5OiAtMSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogW1xyXG4gICAgICAgICAgICAgICAgJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCAnJHRyYW5zY2x1ZGUnLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJHRyYW5zY2x1ZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC52YWx1ZSA9ICRwYXJzZSgkYXR0cnMudmFsdWUpKCRzY29wZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5sYWJlbCA9ICRwYXJzZSgkYXR0cnMubGFiZWwpKCRzY29wZSk7XHJcbiAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAnb3B0aW9uJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogWydiZ09wdGlvbicsICdeYmdTZWxlY3RvciddLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1jaG9pY2VcIj48L2Rpdj4nLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBpRWxtLCBpQXR0cnMsIGN0cmxzLCB0cmFuc2NsdWRlRm4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBiZ09wdGlvbiA9IGN0cmxzWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJnU2VsZWN0b3IgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgIGlFbG0uYmluZCgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gYmdPcHRpb24udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gYmdPcHRpb24ubGFiZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFsYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCA9ICfor7fpgInmi6knO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHZhbHVlIGFuZCBsYWJlbCBvZiB0aGUgc2VsZWN0b3Igd2hlbiBvcHRpb24gY2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iuc2V0VmFsdWUodmFsdWUsIGxhYmVsKTtcclxuICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLmhpZGVDaG9pY2VMaXN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJpZ2dlciB0aGUgY2FsbGJhY2tcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmdTZWxlY3Rvci5vblNlbGVjdENhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iub25TZWxlY3RDYWxsYmFjayh2YWx1ZSwgbGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKGJnT3B0aW9uLnZhbHVlLCBiZ1NlbGVjdG9yLmdldFZhbHVlKCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKGJnT3B0aW9uLmxhYmVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBsaXN0ZW4gdG8gdGhlIGNoYW5nZSBldmVudCB0byBzZXQgdGhlIGxhYmVsIG9mIHRoZSBzZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignYmdzOmNoYW5nZScsIGZ1bmN0aW9uIChldmVudCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IGJnT3B0aW9uLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChiZ09wdGlvbi5sYWJlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLmFkZE9wdGlvbihiZ09wdGlvbi52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGlBdHRycy52YWx1ZSwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvbGRWYWx1ZSAmJiBuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdPcHRpb24udmFsdWUgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGlBdHRycy5sYWJlbCwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvbGRWYWx1ZSAmJiBuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdPcHRpb24ubGFiZWwgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2NsdWRlRm4oZnVuY3Rpb24gKGNsb25lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaUVsbS5hcHBlbmQoY2xvbmUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xyXG59KTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
