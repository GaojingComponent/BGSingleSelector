define(["angular"],function(e){var t=e.module("bg.selector",[]);t.directive("bgSelector",["$document","$parse",function(t,l){var n=function(e,t){t=t||[];for(var l=t.length,n=0;l>n;n++){var o=t[n];if(o===e)return!0}return!1};return{scope:{},controller:["$scope","$element","$attrs","$transclude",function(e,t,l,n){var o=this;o.options=[],o.open=!1,o.hideChoiceList=function(){o.open=!1},o.toggleChoiceList=function(){o.open=!o.open},o.setSelectorLabel=function(e){o.label=e},o.addOption=function(e){o.options.push(e)}}],controllerAs:"selector",require:["bgSelector","ngModel"],restrict:"E",template:function(e,t){t.ngModel;return'<div class="bg-selector-container"><div class="bg-selector-bar"><div class="bg-selector-content" ng-bind-template="{{selector.label}}"></div><div class="bg-selector-icon" ng-class="{true: \'open\'}[selector.open]"></div></div><div class="bg-choice-list" ng-show="selector.open"></div></div>'},replace:!0,transclude:!0,link:function(o,c,a,i,r){var s=i[0],u=i[1],b=a.placeholder||"请选择",p=e.element(c[0].querySelector(".bg-choice-list")),d=e.element(c[0].querySelector(".bg-selector-bar"));s.onSelectCallback=l(a.onSelect)(o.$parent),d.bind("click",function(e){s.toggleChoiceList(),o.$apply(),e.stopPropagation()}),t.bind("click",function(e){s.open&&s.hideChoiceList(),o.$apply()}),o.$parent.$watch(a.ngModel,function(e){n(e,s.options)?(console.log("change"),o.$broadcast("bgs:change",e)):s.setSelectorLabel(b)}),s.setValue=function(e,t){u.$setViewValue(e),s.setSelectorLabel(t)},s.getValue=function(){return u.$modelValue},s.clearValue=function(){u.$setViewValue(null),s.setSelectorLabel(b)},r(function(e){p.append(e)}),s.setSelectorLabel(b)}}}]),t.directive("bgOption",["$parse",function(e){return{priority:-1,controller:["$scope","$element","$attrs","$transclude",function(t,l,n,o){var c=this;c.value=e(n.value)(t),c.label=e(n.label)(t)}],controllerAs:"option",require:["bgOption","^bgSelector"],restrict:"E",template:'<div class="bg-selector-choice"></div>',replace:!0,transclude:!0,link:function(e,t,l,n,o){var c=n[0],a=n[1];t.bind("click",function(){var e=c.value,t=c.label;t||(e="请选择"),a.setValue(e,t),a.hideChoiceList(),a.onSelectCallback&&a.onSelectCallback(e,t)}),c.value===a.getValue()&&a.setSelectorLabel(c.label),e.$on("bgs:change",function(e,t){t===c.value&&a.setSelectorLabel(c.label)}),a.addOption(c.value),e.$watch(l.value,function(e,t){t&&e!==t&&(c.value=e,a.clearValue())}),e.$watch(l.label,function(e,t){t&&e!==t&&(c.label=e,a.clearValue())}),o(function(e){t.append(e)})}}}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJnLXNpbmdsZS1zZWxlY3Rvci5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJhbmd1bGFyIiwiYmdzIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiJGRvY3VtZW50IiwiJHBhcnNlIiwiaXNFeGlzdCIsInZhbHVlIiwib3B0aW9ucyIsImxlbmd0aCIsImkiLCJ0ZW1wIiwic2NvcGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkdHJhbnNjbHVkZSIsImN0cmwiLCJ0aGlzIiwib3BlbiIsImhpZGVDaG9pY2VMaXN0IiwidG9nZ2xlQ2hvaWNlTGlzdCIsInNldFNlbGVjdG9yTGFiZWwiLCJsYWJlbCIsImFkZE9wdGlvbiIsInB1c2giLCJjb250cm9sbGVyQXMiLCJyZXF1aXJlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZSIsImlFbG0iLCJpQXR0cnMiLCJuZ01vZGVsIiwicmVwbGFjZSIsInRyYW5zY2x1ZGUiLCJsaW5rIiwiY3RybHMiLCJ0cmFuc2NsdWRlRm4iLCJzZWxlY3RvciIsInBsYWNlaG9sZGVyIiwiY2hvaWNlTGlzdCIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2VsZWN0b3JCYXIiLCJvblNlbGVjdENhbGxiYWNrIiwib25TZWxlY3QiLCIkcGFyZW50IiwiYmluZCIsImUiLCIkYXBwbHkiLCJzdG9wUHJvcGFnYXRpb24iLCIkd2F0Y2giLCJjb25zb2xlIiwibG9nIiwiJGJyb2FkY2FzdCIsInNldFZhbHVlIiwiJHNldFZpZXdWYWx1ZSIsImdldFZhbHVlIiwiJG1vZGVsVmFsdWUiLCJjbGVhclZhbHVlIiwiY2xvbmUiLCJhcHBlbmQiLCJwcmlvcml0eSIsImJnT3B0aW9uIiwiYmdTZWxlY3RvciIsIiRvbiIsImV2ZW50IiwibmV3VmFsdWUiLCJvbGRWYWx1ZSJdLCJtYXBwaW5ncyI6IkFBS0FBLFFBQVEsV0FBWSxTQUFVQyxHQUMxQixHQUFJQyxHQUFNRCxFQUFRRSxPQUFPLGlCQUV6QkQsR0FBSUUsVUFBVSxjQUFl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QUNoQkEsS0FDRGpCLEVBQVEsT0FHWjBELEVBQVdULFNBQVNqRCxFQUFPaUIsR0FDM0J5QyxFQUFXNUMsaUJBRVA0QyxFQUFXcEIsa0JBQ1hvQixFQUFXcEIsaUJBQWlCdEMsRUFBT2lCLEtBR3ZDd0MsRUFBU3pELFFBQVUwRCxFQUFXUCxZQUM5Qk8sRUFBVzFDLGlCQUFpQnlDLEVBQVN4QyxPQUl6Q1YsRUFBT29ELElBQUksYUFBYyxTQUFVQyxFQUFPNUQsR0FDbENBLElBQVV5RCxFQUFTekQsT0FDbkIwRCxFQUFXMUMsaUJBQWlCeUMsRUFBU3hDLFNBRzdDeUMsRUFBV3hDLFVBQVV1QyxFQUFTekQsT0FDOUJPLEVBQU9zQyxPQUFPcEIsRUFBT3pCLE1BQU8sU0FBVTZELEVBQVVDLEdBQ3hDQSxHQUFZRCxJQUFhQyxJQUN6QkwsRUFBU3pELE1BQVE2RCxFQUNqQkgsRUFBV0wsZ0JBR25COUMsRUFBT3NDLE9BQU9wQixFQUFPUixNQUFPLFNBQVU0QyxFQUFVQyxHQUN4Q0EsR0FBWUQsSUFBYUMsSUFDekJMLEVBQVN4QyxNQUFRNEMsRUFDakJILEVBQVdMLGdCQUduQnRCLEVBQWEsU0FBVXVCLEdBQ25COUIsRUFBSytCLE9BQU9EIiwiZmlsZSI6ImJnLXNpbmdsZS1zZWxlY3Rvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZSDljZXpgInkuIvmi4nmoYbnu4Tku7ZcclxuICogQGF1dGhvciBsYWtiMjQ4QGdtYWlsLmNvbVxyXG4gKi9cclxuXHJcbmRlZmluZShbJ2FuZ3VsYXInXSwgZnVuY3Rpb24gKGFuZ3VsYXIpIHtcclxuICAgIHZhciBiZ3MgPSBhbmd1bGFyLm1vZHVsZSgnYmcuc2VsZWN0b3InLCBbXSk7XHJcblxyXG4gICAgYmdzLmRpcmVjdGl2ZSgnYmdTZWxlY3RvcicsIFsnJGRvY3VtZW50JywgJyRwYXJzZScsIGZ1bmN0aW9uICgkZG9jdW1lbnQsICRwYXJzZSkge1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiB3aGV0aGVyIHRoZSB2YWx1ZSBleGlzdCBpbiB0aGUgb3B0aW9uc1xyXG4gICAgICAgICAqIEBhdXRob3IgbGFrYjI0OEBnbWFpbC5jb21cclxuICAgICAgICAgKiBAcGFyYW0gIHtzdHJpbmd9ICB2YWx1ZSAgIHRoZSB2YWx1ZVxyXG4gICAgICAgICAqIEBwYXJhbSAge3N0cmluZ30gIG9wdGlvbnMgdGhlIG9wdGlvbnNcclxuICAgICAgICAgKiBAcmV0dXJuIHtib29sZWFufSByZXR1bHQgIHRoZSByZXN1bHRcclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgaXNFeGlzdCA9IGZ1bmN0aW9uICh2YWx1ZSwgb3B0aW9ucykge1xyXG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IG9wdGlvbnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBvcHRpb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXAgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gUnVucyBkdXJpbmcgY29tcGlsZVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7fSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogW1xyXG4gICAgICAgICAgICAgICAgJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCAnJHRyYW5zY2x1ZGUnLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJHRyYW5zY2x1ZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5vcHRpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5vcGVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBjaG9pY2UgbGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuaGlkZUNob2ljZUxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9nZ2xlIHRoZSBzdGF0dXMgb2YgY2hvaWNlIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnRvZ2dsZUNob2ljZUxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3BlbiA9ICFjdHJsLm9wZW47XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIGxhYmVsIG9mIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZXRTZWxlY3RvckxhYmVsID0gZnVuY3Rpb24gKGxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwubGFiZWwgPSBsYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuYWRkT3B0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3B0aW9ucy5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3NlbGVjdG9yJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogWydiZ1NlbGVjdG9yJywgJ25nTW9kZWwnXSxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6IGZ1bmN0aW9uIChpRWxtLCBpQXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtb2RlbE5hbWUgPSBpQXR0cnMubmdNb2RlbDtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWNvbnRhaW5lclwiPidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWJhclwiPidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1jb250ZW50XCIgbmctYmluZC10ZW1wbGF0ZT1cInt7c2VsZWN0b3IubGFiZWx9fVwiPjwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1pY29uXCIgbmctY2xhc3M9XCJ7dHJ1ZTogXFwnb3BlblxcJ31bc2VsZWN0b3Iub3Blbl1cIj48L2Rpdj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLWNob2ljZS1saXN0XCIgbmctc2hvdz1cInNlbGVjdG9yLm9wZW5cIj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBpRWxtLCBpQXR0cnMsIGN0cmxzLCB0cmFuc2NsdWRlRm4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RvciA9IGN0cmxzWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5nTW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlciA9IGlBdHRycy5wbGFjZWhvbGRlciB8fCAn6K+36YCJ5oupJztcclxuICAgICAgICAgICAgICAgIHZhciBjaG9pY2VMaXN0ID0gYW5ndWxhci5lbGVtZW50KGlFbG1bMF0ucXVlcnlTZWxlY3RvcignLmJnLWNob2ljZS1saXN0JykpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yQmFyID0gYW5ndWxhci5lbGVtZW50KGlFbG1bMF0ucXVlcnlTZWxlY3RvcignLmJnLXNlbGVjdG9yLWJhcicpKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLm9uU2VsZWN0Q2FsbGJhY2sgPSAkcGFyc2UoaUF0dHJzLm9uU2VsZWN0KSgkc2NvcGUuJHBhcmVudCk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RvckJhci5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IudG9nZ2xlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyBiaW5kIGNsaWNrIGV2ZW50IHRvIGhpZGUgdGhlIGNob2ljZSBsaXN0IHdoZW4gZG9jdW1lbnQgY2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgJGRvY3VtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3Iub3Blbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5oaWRlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHdhdGNoIG5nTW9kZWwgdG8gc2V0IHRoZSBsYWJlbFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQuJHdhdGNoKGlBdHRycy5uZ01vZGVsLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRXhpc3QodmFsdWUsIHNlbGVjdG9yLm9wdGlvbnMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2JnczpjaGFuZ2UnLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAgICAgKiBzZXQgdmFsdWUgYW5kIGxhYmVsIG9mIHRoZSBzZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHZhbHVlIHRoZSB2YWx1ZSB0byBzZXRcclxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBsYWJlbCB0aGUgbGFiZWwgdG8gc2V0XHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFZhbHVlID0gZnVuY3Rpb24gKHZhbHVlLCBsYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChsYWJlbCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICogZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gdGhlIHZhbHVlIG9mIHRoZSBzZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvci5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmdNb2RlbC4kbW9kZWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAgICAgKiBjbGVhciB0aGUgdmFsdWUgb2YgdGhlIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLmNsZWFyVmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB0cmFuc2NsdWRlRm4oZnVuY3Rpb24gKGNsb25lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hvaWNlTGlzdC5hcHBlbmQoY2xvbmUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKHBsYWNlaG9sZGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG4gICAgYmdzLmRpcmVjdGl2ZSgnYmdPcHRpb24nLCBbJyRwYXJzZScsIGZ1bmN0aW9uICgkcGFyc2UpIHtcclxuICAgICAgICAvLyBSdW5zIGR1cmluZyBjb21waWxlXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJpb3JpdHk6IC0xLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbXHJcbiAgICAgICAgICAgICAgICAnJHNjb3BlJywgJyRlbGVtZW50JywgJyRhdHRycycsICckdHJhbnNjbHVkZScsXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkZWxlbWVudCwgJGF0dHJzLCAkdHJhbnNjbHVkZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdHJsID0gdGhpcztcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnZhbHVlID0gJHBhcnNlKCRhdHRycy52YWx1ZSkoJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmxhYmVsID0gJHBhcnNlKCRhdHRycy5sYWJlbCkoJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdvcHRpb24nLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJ2JnT3B0aW9uJywgJ15iZ1NlbGVjdG9yJ10sXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWNob2ljZVwiPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGlFbG0sIGlBdHRycywgY3RybHMsIHRyYW5zY2x1ZGVGbikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJnT3B0aW9uID0gY3RybHNbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgYmdTZWxlY3RvciA9IGN0cmxzWzFdO1xyXG4gICAgICAgICAgICAgICAgaUVsbS5iaW5kKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBiZ09wdGlvbi52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBiZ09wdGlvbi5sYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJ+ivt+mAieaLqSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgdmFsdWUgYW5kIGxhYmVsIG9mIHRoZSBzZWxlY3RvciB3aGVuIG9wdGlvbiBjbGlja2VkXHJcbiAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5zZXRWYWx1ZSh2YWx1ZSwgbGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3IuaGlkZUNob2ljZUxpc3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0cmlnZ2VyIHRoZSBjYWxsYmFja1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiZ1NlbGVjdG9yLm9uU2VsZWN0Q2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5vblNlbGVjdENhbGxiYWNrKHZhbHVlLCBsYWJlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmdPcHRpb24udmFsdWUgPT09IGJnU2VsZWN0b3IuZ2V0VmFsdWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChiZ09wdGlvbi5sYWJlbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gbGlzdGVuIHRvIHRoZSBjaGFuZ2UgZXZlbnQgdG8gc2V0IHRoZSBsYWJlbCBvZiB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oJ2JnczpjaGFuZ2UnLCBmdW5jdGlvbiAoZXZlbnQsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBiZ09wdGlvbi52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwoYmdPcHRpb24ubGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5hZGRPcHRpb24oYmdPcHRpb24udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChpQXR0cnMudmFsdWUsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2xkVmFsdWUgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnT3B0aW9uLnZhbHVlID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3IuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChpQXR0cnMubGFiZWwsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2xkVmFsdWUgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnT3B0aW9uLmxhYmVsID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3IuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdHJhbnNjbHVkZUZuKGZ1bmN0aW9uIChjbG9uZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlFbG0uYXBwZW5kKGNsb25lKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxufSk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
