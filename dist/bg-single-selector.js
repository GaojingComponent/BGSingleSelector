define(["angular"],function(e){var t=e.module("bg.selector",[]);t.directive("bgSelector",["$document","$parse",function(t,l){var n=function(e,t){t=t||[];for(var l=t.length,n=0;l>n;n++){var o=t[n];if(o===e)return!0}return!1};return{scope:{},controller:["$scope","$element","$attrs","$transclude",function(e,t,l,n){var o=this;o.options=[],o.open=!1,o.hideChoiceList=function(){o.open=!1},o.toggleChoiceList=function(){o.open=!o.open},o.setSelectorLabel=function(e){o.label=e},o.addOption=function(e){o.options.push(e)}}],controllerAs:"selector",require:["bgSelector","ngModel"],restrict:"E",template:function(e,t){t.ngModel;return'<div class="bg-selector-container"><div class="bg-selector-bar"><div class="bg-selector-content" ng-bind-template="{{selector.label}}"></div><div class="bg-selector-icon" ng-class="{true: \'open\'}[selector.open]"></div></div><div class="bg-choice-list" ng-show="selector.open"></div></div>'},replace:!0,transclude:!0,link:function(o,c,a,i,r){var s=i[0],u=i[1],b=a.placeholder||"请选择",p=e.element(c[0].querySelector(".bg-choice-list")),d=e.element(c[0].querySelector(".bg-selector-bar"));s.onSelectCallback=l(a.onSelect)(o.$parent),d.bind("click",function(e){s.toggleChoiceList(),o.$apply(),e.stopPropagation()}),t.bind("click",function(e){s.open&&s.hideChoiceList(),o.$apply()}),o.$parent.$watch(a.ngModel,function(e){n(e,s.options)?o.$broadcast("bgs:change",e):s.setSelectorLabel(b)}),s.setValue=function(e,t){u.$setViewValue(e),s.setSelectorLabel(t)},s.getValue=function(){return u.$modelValue},s.clearValue=function(){u.$setViewValue(null),s.setSelectorLabel(b)},r(function(e){p.append(e)}),s.setSelectorLabel(b)}}}]),t.directive("bgOption",["$parse",function(e){return{priority:-1,controller:["$scope","$element","$attrs","$transclude",function(t,l,n,o){var c=this;c.value=e(n.value)(t),c.label=e(n.label)(t)}],controllerAs:"option",require:["bgOption","^bgSelector"],restrict:"E",template:'<div class="bg-selector-choice"></div>',replace:!0,transclude:!0,link:function(e,t,l,n,o){var c=n[0],a=n[1];t.bind("click",function(){var e=c.value,t=c.label;t||(e="请选择"),a.setValue(e,t),a.hideChoiceList(),a.onSelectCallback&&a.onSelectCallback(e,t)}),c.value===a.getValue()&&a.setSelectorLabel(c.label),e.$on("bgs:change",function(e,t){t===c.value&&a.setSelectorLabel(c.label)}),a.addOption(c.value),e.$watch(l.value,function(e,t){t&&e!==t&&a.clearValue()}),e.$watch(l.label,function(e,t){t&&e!==t&&a.clearValue()}),o(function(e){t.append(e)})}}}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJnLXNpbmdsZS1zZWxlY3Rvci5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJhbmd1bGFyIiwiYmdzIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiJGRvY3VtZW50IiwiJHBhcnNlIiwiaXNFeGlzdCIsInZhbHVlIiwib3B0aW9ucyIsImxlbmd0aCIsImkiLCJ0ZW1wIiwic2NvcGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkdHJhbnNjbHVkZSIsImN0cmwiLCJ0aGlzIiwib3BlbiIsImhpZGVDaG9pY2VMaXN0IiwidG9nZ2xlQ2hvaWNlTGlzdCIsInNldFNlbGVjdG9yTGFiZWwiLCJsYWJlbCIsImFkZE9wdGlvbiIsInB1c2giLCJjb250cm9sbGVyQXMiLCJyZXF1aXJlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZSIsImlFbG0iLCJpQXR0cnMiLCJuZ01vZGVsIiwicmVwbGFjZSIsInRyYW5zY2x1ZGUiLCJsaW5rIiwiY3RybHMiLCJ0cmFuc2NsdWRlRm4iLCJzZWxlY3RvciIsInBsYWNlaG9sZGVyIiwiY2hvaWNlTGlzdCIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2VsZWN0b3JCYXIiLCJvblNlbGVjdENhbGxiYWNrIiwib25TZWxlY3QiLCIkcGFyZW50IiwiYmluZCIsImUiLCIkYXBwbHkiLCJzdG9wUHJvcGFnYXRpb24iLCIkd2F0Y2giLCIkYnJvYWRjYXN0Iiwic2V0VmFsdWUiLCIkc2V0Vmlld1ZhbHVlIiwiZ2V0VmFsdWUiLCIkbW9kZWxWYWx1ZSIsImNsZWFyVmFsdWUiLCJjbG9uZSIsImFwcGVuZCIsInByaW9yaXR5IiwiYmdPcHRpb24iLCJiZ1NlbGVjdG9yIiwiJG9uIiwiZXZlbnQiLCJuZXdWYWx1ZSIsIm9sZFZhbHVlIl0sIm1hcHBpbmdzIjoiQUFLQUEsUUFBUSxXQUFZLFNBQVVDLEdBQzFCLEdBQUlDLEdBQU1ELEVBQVFFLE9BQU8saUJBRXpCRCxHQUFJRSxVQUFVLGNBQWUsWUFBYSxTQUFVLFNBQVVD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QyxFQUFPaUIsR0FDM0J1QyxFQUFXMUMsaUJBRVAwQyxFQUFXbEIsa0JBQ1hrQixFQUFXbEIsaUJBQWlCdEMsRUFBT2lCLEtBR3ZDc0MsRUFBU3ZELFFBQVV3RCxFQUFXUCxZQUM5Qk8sRUFBV3hDLGlCQUFpQnVDLEVBQVN0QyxPQUl6Q1YsRUFBT2tELElBQUksYUFBYyxTQUFVQyxFQUFPMUQsR0FDbENBLElBQVV1RCxFQUFTdkQsT0FDbkJ3RCxFQUFXeEMsaUJBQWlCdUMsRUFBU3RDLFNBRzdDdUMsRUFBV3RDLFVBQVVxQyxFQUFTdkQsT0FDOUJPLEVBQU9zQyxPQUFPcEIsRUFBT3pCLE1BQU8sU0FBVTJELEVBQVVDLEdBQ3hDQSxHQUFZRCxJQUFhQyxHQUN6QkosRUFBV0wsZUFHbkI1QyxFQUFPc0MsT0FBT3BCLEVBQU9SLE1BQU8sU0FBVTBDLEVBQVVDLEdBQ3hDQSxHQUFZRCxJQUFhQyxHQUN6QkosRUFBV0wsZUFHbkJwQixFQUFhLFNBQVVxQixHQUNuQjVCLEVBQUs2QixPQUFPRCIsImZpbGUiOiJiZy1zaW5nbGUtc2VsZWN0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGZpbGUg5Y2V6YCJ5LiL5ouJ5qGG57uE5Lu2XHJcbiAqIEBhdXRob3IgbGFrYjI0OEBnbWFpbC5jb21cclxuICovXHJcblxyXG5kZWZpbmUoWydhbmd1bGFyJ10sIGZ1bmN0aW9uIChhbmd1bGFyKSB7XHJcbiAgICB2YXIgYmdzID0gYW5ndWxhci5tb2R1bGUoJ2JnLnNlbGVjdG9yJywgW10pO1xyXG5cclxuICAgIGJncy5kaXJlY3RpdmUoJ2JnU2VsZWN0b3InLCBbJyRkb2N1bWVudCcsICckcGFyc2UnLCBmdW5jdGlvbiAoJGRvY3VtZW50LCAkcGFyc2UpIHtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogd2hldGhlciB0aGUgdmFsdWUgZXhpc3QgaW4gdGhlIG9wdGlvbnNcclxuICAgICAgICAgKiBAYXV0aG9yIGxha2IyNDhAZ21haWwuY29tXHJcbiAgICAgICAgICogQHBhcmFtICB7c3RyaW5nfSAgdmFsdWUgICB0aGUgdmFsdWVcclxuICAgICAgICAgKiBAcGFyYW0gIHtzdHJpbmd9ICBvcHRpb25zIHRoZSBvcHRpb25zXHJcbiAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gcmV0dWx0ICB0aGUgcmVzdWx0XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGlzRXhpc3QgPSBmdW5jdGlvbiAodmFsdWUsIG9wdGlvbnMpIHtcclxuICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgW107XHJcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSBvcHRpb25zLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gb3B0aW9uc1tpXTtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1wID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIFJ1bnMgZHVyaW5nIGNvbXBpbGVcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFtcclxuICAgICAgICAgICAgICAgICckc2NvcGUnLCAnJGVsZW1lbnQnLCAnJGF0dHJzJywgJyR0cmFuc2NsdWRlJyxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsICR0cmFuc2NsdWRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN0cmwgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwub3B0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgY2hvaWNlIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmhpZGVDaG9pY2VMaXN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLm9wZW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRvZ2dsZSB0aGUgc3RhdHVzIG9mIGNob2ljZSBsaXN0XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC50b2dnbGVDaG9pY2VMaXN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLm9wZW4gPSAhY3RybC5vcGVuO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBsYWJlbCBvZiBzZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuc2V0U2VsZWN0b3JMYWJlbCA9IGZ1bmN0aW9uIChsYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLmxhYmVsID0gbGFiZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmFkZE9wdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLm9wdGlvbnMucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdzZWxlY3RvcicsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFsnYmdTZWxlY3RvcicsICduZ01vZGVsJ10sXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiBmdW5jdGlvbiAoaUVsbSwgaUF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbW9kZWxOYW1lID0gaUF0dHJzLm5nTW9kZWw7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1jb250YWluZXJcIj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1iYXJcIj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArICc8ZGl2IGNsYXNzPVwiYmctc2VsZWN0b3ItY29udGVudFwiIG5nLWJpbmQtdGVtcGxhdGU9XCJ7e3NlbGVjdG9yLmxhYmVsfX1cIj48L2Rpdj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArICc8ZGl2IGNsYXNzPVwiYmctc2VsZWN0b3ItaWNvblwiIG5nLWNsYXNzPVwie3RydWU6IFxcJ29wZW5cXCd9W3NlbGVjdG9yLm9wZW5dXCI+PC9kaXY+J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICArICc8L2Rpdj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1jaG9pY2UtbGlzdFwiIG5nLXNob3c9XCJzZWxlY3Rvci5vcGVuXCI+J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICArICc8L2Rpdj4nXHJcbiAgICAgICAgICAgICAgICAgICAgKyAnPC9kaXY+JztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgaUVsbSwgaUF0dHJzLCBjdHJscywgdHJhbnNjbHVkZUZuKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0b3IgPSBjdHJsc1swXTtcclxuICAgICAgICAgICAgICAgIHZhciBuZ01vZGVsID0gY3RybHNbMV07XHJcbiAgICAgICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXIgPSBpQXR0cnMucGxhY2Vob2xkZXIgfHwgJ+ivt+mAieaLqSc7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hvaWNlTGlzdCA9IGFuZ3VsYXIuZWxlbWVudChpRWxtWzBdLnF1ZXJ5U2VsZWN0b3IoJy5iZy1jaG9pY2UtbGlzdCcpKTtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RvckJhciA9IGFuZ3VsYXIuZWxlbWVudChpRWxtWzBdLnF1ZXJ5U2VsZWN0b3IoJy5iZy1zZWxlY3Rvci1iYXInKSk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvci5vblNlbGVjdENhbGxiYWNrID0gJHBhcnNlKGlBdHRycy5vblNlbGVjdCkoJHNjb3BlLiRwYXJlbnQpO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3JCYXIuYmluZCgnY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnRvZ2dsZUNob2ljZUxpc3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy8gYmluZCBjbGljayBldmVudCB0byBoaWRlIHRoZSBjaG9pY2UgbGlzdCB3aGVuIGRvY3VtZW50IGNsaWNrZWRcclxuICAgICAgICAgICAgICAgICRkb2N1bWVudC5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yLm9wZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IuaGlkZUNob2ljZUxpc3QoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyB3YXRjaCBuZ01vZGVsIHRvIHNldCB0aGUgbGFiZWxcclxuICAgICAgICAgICAgICAgICRzY29wZS4kcGFyZW50LiR3YXRjaChpQXR0cnMubmdNb2RlbCwgZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgdGhlIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0V4aXN0KHZhbHVlLCBzZWxlY3Rvci5vcHRpb25zKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKHBsYWNlaG9sZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnYmdzOmNoYW5nZScsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvci5zZXRWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgbGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwobGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLmdldFZhbHVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZ01vZGVsLiRtb2RlbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLmNsZWFyVmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB0cmFuc2NsdWRlRm4oZnVuY3Rpb24gKGNsb25lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hvaWNlTGlzdC5hcHBlbmQoY2xvbmUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKHBsYWNlaG9sZGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcblxyXG4gICAgYmdzLmRpcmVjdGl2ZSgnYmdPcHRpb24nLCBbJyRwYXJzZScsIGZ1bmN0aW9uICgkcGFyc2UpIHtcclxuICAgICAgICAvLyBSdW5zIGR1cmluZyBjb21waWxlXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcHJpb3JpdHk6IC0xLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbXHJcbiAgICAgICAgICAgICAgICAnJHNjb3BlJywgJyRlbGVtZW50JywgJyRhdHRycycsICckdHJhbnNjbHVkZScsXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkZWxlbWVudCwgJGF0dHJzLCAkdHJhbnNjbHVkZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdHJsID0gdGhpcztcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnZhbHVlID0gJHBhcnNlKCRhdHRycy52YWx1ZSkoJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLmxhYmVsID0gJHBhcnNlKCRhdHRycy5sYWJlbCkoJHNjb3BlKTtcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdvcHRpb24nLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJ2JnT3B0aW9uJywgJ15iZ1NlbGVjdG9yJ10sXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWNob2ljZVwiPjwvZGl2PicsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGlFbG0sIGlBdHRycywgY3RybHMsIHRyYW5zY2x1ZGVGbikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJnT3B0aW9uID0gY3RybHNbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgYmdTZWxlY3RvciA9IGN0cmxzWzFdO1xyXG4gICAgICAgICAgICAgICAgaUVsbS5iaW5kKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBiZ09wdGlvbi52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGFiZWwgPSBiZ09wdGlvbi5sYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJ+ivt+mAieaLqSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgdmFsdWUgYW5kIGxhYmVsIG9mIHRoZSBzZWxlY3RvciB3aGVuIG9wdGlvbiBjbGlja2VkXHJcbiAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5zZXRWYWx1ZSh2YWx1ZSwgbGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3IuaGlkZUNob2ljZUxpc3QoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0cmlnZ2VyIHRoZSBjYWxsYmFja1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiZ1NlbGVjdG9yLm9uU2VsZWN0Q2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5vblNlbGVjdENhbGxiYWNrKHZhbHVlLCBsYWJlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmdPcHRpb24udmFsdWUgPT09IGJnU2VsZWN0b3IuZ2V0VmFsdWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChiZ09wdGlvbi5sYWJlbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gbGlzdGVuIHRvIHRoZSBjaGFuZ2UgZXZlbnQgdG8gc2V0IHRoZSBsYWJlbCBvZiB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICRzY29wZS4kb24oJ2JnczpjaGFuZ2UnLCBmdW5jdGlvbiAoZXZlbnQsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBiZ09wdGlvbi52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwoYmdPcHRpb24ubGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5hZGRPcHRpb24oYmdPcHRpb24udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChpQXR0cnMudmFsdWUsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2xkVmFsdWUgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3IuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChpQXR0cnMubGFiZWwsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2xkVmFsdWUgJiYgbmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3IuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdHJhbnNjbHVkZUZuKGZ1bmN0aW9uIChjbG9uZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlFbG0uYXBwZW5kKGNsb25lKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxufSk7XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
