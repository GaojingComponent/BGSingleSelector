define(["angular"],function(e){var l=e.module("bg.selector",[]);l.directive("bgSelector",["$document","$parse",function(l,t){var n=function(e,l){l=l||[];for(var t=l.length,n=0;t>n;n++){var o=l[n];if(o===e)return!0}return!1};return{scope:{},controller:["$scope","$element","$attrs","$transclude",function(e,l,t,n){var o=this;o.options=[],o.open=!1,o.hideChoiceList=function(){o.open=!1},o.toggleChoiceList=function(){o.open=!o.open},o.setSelectorLabel=function(e){o.label=e},o.addOption=function(e){o.options.push(e)}}],controllerAs:"selector",require:["bgSelector","ngModel"],restrict:"E",template:function(e,l){l.ngModel;return'<div class="bg-selector-container"><div class="bg-selector-bar"><div class="bg-selector-content" ng-bind-template="{{selector.label}}"></div><div class="bg-selector-icon" ng-class="{true: \'open\'}[selector.open]"></div></div><div class="bg-choice-list" ng-show="selector.open"></div></div>'},replace:!0,transclude:!0,link:function(o,c,a,i,r){var s=i[0],u=i[1],d=a.placeholder||"请选择",p=e.element(c[0].querySelector(".bg-choice-list")),b=e.element(c[0].querySelector(".bg-selector-bar"));s.onSelectCallback=t(a.onSelect)(o.$parent),b.bind("click",function(e){s.toggleChoiceList(),o.$apply(),e.stopPropagation()}),l.bind("click",function(e){s.open&&s.hideChoiceList(),o.$apply()}),o.$parent.$watch(a.ngModel,function(e){n(e,s.options)?o.$broadcast("bgs:change",e):(s.clearValue(),console.log("not exist"))}),s.setValue=function(e,l){u.$setViewValue(e),s.setSelectorLabel(l)},s.getValue=function(){return u.$modelValue},s.clearValue=function(){u.$setViewValue(null),s.setSelectorLabel(d)},r(function(e){p.append(e)}),s.clearValue(),console.log("init and clear value")}}}]),l.directive("bgOption",["$parse",function(e){return{priority:-1,controller:["$scope","$element","$attrs","$transclude",function(l,t,n,o){var c=this;c.value=e(n.value)(l),c.label=e(n.label)(l)}],controllerAs:"option",require:["bgOption","^bgSelector"],restrict:"E",template:'<div class="bg-selector-choice"></div>',replace:!0,transclude:!0,link:function(e,l,t,n,o){var c=n[0],a=n[1];l.bind("click",function(){var e=c.value,l=c.label;l||(e="请选择"),a.setValue(e,l),a.hideChoiceList(),a.onSelectCallback&&a.onSelectCallback(e,l)}),c.value===a.getValue()&&a.setSelectorLabel(c.label),e.$on("bgs:change",function(e,l){l===c.value&&a.setSelectorLabel(c.label)}),a.addOption(c.value),e.$watch(t.value,function(e,l){l&&e!==l&&(c.value=e,a.clearValue())}),e.$watch(t.label,function(e,l){l&&e!==l&&(c.label=e,a.clearValue())}),o(function(e){l.append(e)})}}}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJnLXNpbmdsZS1zZWxlY3Rvci5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJhbmd1bGFyIiwiYmdzIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiJGRvY3VtZW50IiwiJHBhcnNlIiwiaXNFeGlzdCIsInZhbHVlIiwib3B0aW9ucyIsImxlbmd0aCIsImkiLCJ0ZW1wIiwic2NvcGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkdHJhbnNjbHVkZSIsImN0cmwiLCJ0aGlzIiwib3BlbiIsImhpZGVDaG9pY2VMaXN0IiwidG9nZ2xlQ2hvaWNlTGlzdCIsInNldFNlbGVjdG9yTGFiZWwiLCJsYWJlbCIsImFkZE9wdGlvbiIsInB1c2giLCJjb250cm9sbGVyQXMiLCJyZXF1aXJlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZSIsImlFbG0iLCJpQXR0cnMiLCJuZ01vZGVsIiwicmVwbGFjZSIsInRyYW5zY2x1ZGUiLCJsaW5rIiwiY3RybHMiLCJ0cmFuc2NsdWRlRm4iLCJzZWxlY3RvciIsInBsYWNlaG9sZGVyIiwiY2hvaWNlTGlzdCIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2VsZWN0b3JCYXIiLCJvblNlbGVjdENhbGxiYWNrIiwib25TZWxlY3QiLCIkcGFyZW50IiwiYmluZCIsImUiLCIkYXBwbHkiLCJzdG9wUHJvcGFnYXRpb24iLCIkd2F0Y2giLCIkYnJvYWRjYXN0IiwiY2xlYXJWYWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJzZXRWYWx1ZSIsIiRzZXRWaWV3VmFsdWUiLCJnZXRWYWx1ZSIsIiRtb2RlbFZhbHVlIiwiY2xvbmUiLCJhcHBlbmQiLCJwcmlvcml0eSIsImJnT3B0aW9uIiwiYmdTZWxlY3RvciIsIiRvbiIsImV2ZW50IiwibmV3VmFsdWUiLCJvbGRWYWx1ZSJdLCJtYXBwaW5ncyI6IkFBS0FBLFFBQVEsV0FBWSxTQUFVQyxHQUMxQixHQUFJQyxHQUFNRCxFQUFRRSxPQUFPLGlCQUV6QkQsR0FBSUUsVUFBVSxjQUFl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QkEsS0FDRGpCLEVBQVEsT0FHWjBELEVBQVdSLFNBQVNsRCxFQUFPaUIsR0FDM0J5QyxFQUFXNUMsaUJBRVA0QyxFQUFXcEIsa0JBQ1hvQixFQUFXcEIsaUJBQWlCdEMsRUFBT2lCLEtBR3ZDd0MsRUFBU3pELFFBQVUwRCxFQUFXTixZQUM5Qk0sRUFBVzFDLGlCQUFpQnlDLEVBQVN4QyxPQUl6Q1YsRUFBT29ELElBQUksYUFBYyxTQUFVQyxFQUFPNUQsR0FDbENBLElBQVV5RCxFQUFTekQsT0FDbkIwRCxFQUFXMUMsaUJBQWlCeUMsRUFBU3hDLFNBRzdDeUMsRUFBV3hDLFVBQVV1QyxFQUFTekQsT0FDOUJPLEVBQU9zQyxPQUFPcEIsRUFBT3pCLE1BQU8sU0FBVTZELEVBQVVDLEdBQ3hDQSxHQUFZRCxJQUFhQyxJQUN6QkwsRUFBU3pELE1BQVE2RCxFQUNqQkgsRUFBV1gsZ0JBR25CeEMsRUFBT3NDLE9BQU9wQixFQUFPUixNQUFPLFNBQVU0QyxFQUFVQyxHQUN4Q0EsR0FBWUQsSUFBYUMsSUFDekJMLEVBQVN4QyxNQUFRNEMsRUFDakJILEVBQVdYLGdCQUduQmhCLEVBQWEsU0FBVXVCLEdBQ25COUIsRUFBSytCLE9BQU9EIiwiZmlsZSI6ImJnLXNpbmdsZS1zZWxlY3Rvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZSDljZXpgInkuIvmi4nmoYbnu4Tku7ZcclxuICogQGF1dGhvciBsYWtiMjQ4QGdtYWlsLmNvbVxyXG4gKi9cclxuXHJcbmRlZmluZShbJ2FuZ3VsYXInXSwgZnVuY3Rpb24gKGFuZ3VsYXIpIHtcclxuICAgIHZhciBiZ3MgPSBhbmd1bGFyLm1vZHVsZSgnYmcuc2VsZWN0b3InLCBbXSk7XHJcblxyXG4gICAgYmdzLmRpcmVjdGl2ZSgnYmdTZWxlY3RvcicsIFsnJGRvY3VtZW50JywgJyRwYXJzZScsIGZ1bmN0aW9uICgkZG9jdW1lbnQsICRwYXJzZSkge1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiB3aGV0aGVyIHRoZSB2YWx1ZSBleGlzdCBpbiB0aGUgb3B0aW9uc1xyXG4gICAgICAgICAqIEBhdXRob3IgbGFrYjI0OEBnbWFpbC5jb21cclxuICAgICAgICAgKiBAcGFyYW0gIHtzdHJpbmd9ICB2YWx1ZSAgIHRoZSB2YWx1ZVxyXG4gICAgICAgICAqIEBwYXJhbSAge3N0cmluZ30gIG9wdGlvbnMgdGhlIG9wdGlvbnNcclxuICAgICAgICAgKiBAcmV0dXJuIHtib29sZWFufSByZXR1bHQgIHRoZSByZXN1bHRcclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgaXNFeGlzdCA9IGZ1bmN0aW9uICh2YWx1ZSwgb3B0aW9ucykge1xyXG4gICAgICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCBbXTtcclxuICAgICAgICAgICAgdmFyIGxlbmd0aCA9IG9wdGlvbnMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBvcHRpb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRlbXAgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gUnVucyBkdXJpbmcgY29tcGlsZVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHNjb3BlOiB7fSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogW1xyXG4gICAgICAgICAgICAgICAgJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCAnJHRyYW5zY2x1ZGUnLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJHRyYW5zY2x1ZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5vcHRpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5vcGVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBjaG9pY2UgbGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuaGlkZUNob2ljZUxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdG9nZ2xlIHRoZSBzdGF0dXMgb2YgY2hvaWNlIGxpc3RcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnRvZ2dsZUNob2ljZUxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3BlbiA9ICFjdHJsLm9wZW47XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIGxhYmVsIG9mIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5zZXRTZWxlY3RvckxhYmVsID0gZnVuY3Rpb24gKGxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwubGFiZWwgPSBsYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuYWRkT3B0aW9uID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwub3B0aW9ucy5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3NlbGVjdG9yJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogWydiZ1NlbGVjdG9yJywgJ25nTW9kZWwnXSxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6IGZ1bmN0aW9uIChpRWxtLCBpQXR0cnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtb2RlbE5hbWUgPSBpQXR0cnMubmdNb2RlbDtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWNvbnRhaW5lclwiPidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWJhclwiPidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1jb250ZW50XCIgbmctYmluZC10ZW1wbGF0ZT1cInt7c2VsZWN0b3IubGFiZWx9fVwiPjwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1pY29uXCIgbmctY2xhc3M9XCJ7dHJ1ZTogXFwnb3BlblxcJ31bc2VsZWN0b3Iub3Blbl1cIj48L2Rpdj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLWNob2ljZS1saXN0XCIgbmctc2hvdz1cInNlbGVjdG9yLm9wZW5cIj4nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJzwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBpRWxtLCBpQXR0cnMsIGN0cmxzLCB0cmFuc2NsdWRlRm4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RvciA9IGN0cmxzWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5nTW9kZWwgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlciA9IGlBdHRycy5wbGFjZWhvbGRlciB8fCAn6K+36YCJ5oupJztcclxuICAgICAgICAgICAgICAgIHZhciBjaG9pY2VMaXN0ID0gYW5ndWxhci5lbGVtZW50KGlFbG1bMF0ucXVlcnlTZWxlY3RvcignLmJnLWNob2ljZS1saXN0JykpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yQmFyID0gYW5ndWxhci5lbGVtZW50KGlFbG1bMF0ucXVlcnlTZWxlY3RvcignLmJnLXNlbGVjdG9yLWJhcicpKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLm9uU2VsZWN0Q2FsbGJhY2sgPSAkcGFyc2UoaUF0dHJzLm9uU2VsZWN0KSgkc2NvcGUuJHBhcmVudCk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RvckJhci5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IudG9nZ2xlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyBiaW5kIGNsaWNrIGV2ZW50IHRvIGhpZGUgdGhlIGNob2ljZSBsaXN0IHdoZW4gZG9jdW1lbnQgY2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgJGRvY3VtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3Iub3Blbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5oaWRlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHdhdGNoIG5nTW9kZWwgdG8gc2V0IHRoZSBsYWJlbFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQuJHdhdGNoKGlBdHRycy5uZ01vZGVsLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRXhpc3QodmFsdWUsIHNlbGVjdG9yLm9wdGlvbnMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdub3QgZXhpc3QnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnYmdzOmNoYW5nZScsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICAgICAqIHNldCB2YWx1ZSBhbmQgbGFiZWwgb2YgdGhlIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWUgdGhlIHZhbHVlIHRvIHNldFxyXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsIHRoZSBsYWJlbCB0byBzZXRcclxuICAgICAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3Iuc2V0VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUsIGxhYmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kc2V0Vmlld1ZhbHVlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKGxhYmVsKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAgICAgKiBnZXQgdGhlIHZhbHVlIG9mIHRoZSBzZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSB0aGUgdmFsdWUgb2YgdGhlIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLmdldFZhbHVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZ01vZGVsLiRtb2RlbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICAgICAqIGNsZWFyIHRoZSB2YWx1ZSBvZiB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3IuY2xlYXJWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWaWV3VmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChwbGFjZWhvbGRlcik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHRyYW5zY2x1ZGVGbihmdW5jdGlvbiAoY2xvbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaG9pY2VMaXN0LmFwcGVuZChjbG9uZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3IuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2luaXQgYW5kIGNsZWFyIHZhbHVlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xyXG5cclxuICAgIGJncy5kaXJlY3RpdmUoJ2JnT3B0aW9uJywgWyckcGFyc2UnLCBmdW5jdGlvbiAoJHBhcnNlKSB7XHJcbiAgICAgICAgLy8gUnVucyBkdXJpbmcgY29tcGlsZVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHByaW9yaXR5OiAtMSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogW1xyXG4gICAgICAgICAgICAgICAgJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCAnJHRyYW5zY2x1ZGUnLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJHRyYW5zY2x1ZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC52YWx1ZSA9ICRwYXJzZSgkYXR0cnMudmFsdWUpKCRzY29wZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5sYWJlbCA9ICRwYXJzZSgkYXR0cnMubGFiZWwpKCRzY29wZSk7XHJcbiAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAnb3B0aW9uJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogWydiZ09wdGlvbicsICdeYmdTZWxlY3RvciddLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJiZy1zZWxlY3Rvci1jaG9pY2VcIj48L2Rpdj4nLFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBpRWxtLCBpQXR0cnMsIGN0cmxzLCB0cmFuc2NsdWRlRm4pIHtcclxuICAgICAgICAgICAgICAgIHZhciBiZ09wdGlvbiA9IGN0cmxzWzBdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJnU2VsZWN0b3IgPSBjdHJsc1sxXTtcclxuICAgICAgICAgICAgICAgIGlFbG0uYmluZCgnY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gYmdPcHRpb24udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhYmVsID0gYmdPcHRpb24ubGFiZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFsYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICfor7fpgInmi6knO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlIHZhbHVlIGFuZCBsYWJlbCBvZiB0aGUgc2VsZWN0b3Igd2hlbiBvcHRpb24gY2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iuc2V0VmFsdWUodmFsdWUsIGxhYmVsKTtcclxuICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLmhpZGVDaG9pY2VMaXN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJpZ2dlciB0aGUgY2FsbGJhY2tcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmdTZWxlY3Rvci5vblNlbGVjdENhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iub25TZWxlY3RDYWxsYmFjayh2YWx1ZSwgbGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJnT3B0aW9uLnZhbHVlID09PSBiZ1NlbGVjdG9yLmdldFZhbHVlKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwoYmdPcHRpb24ubGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGxpc3RlbiB0byB0aGUgY2hhbmdlIGV2ZW50IHRvIHNldCB0aGUgbGFiZWwgb2YgdGhlIHNlbGVjdG9yXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJG9uKCdiZ3M6Y2hhbmdlJywgZnVuY3Rpb24gKGV2ZW50LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gYmdPcHRpb24udmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKGJnT3B0aW9uLmxhYmVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJnU2VsZWN0b3IuYWRkT3B0aW9uKGJnT3B0aW9uLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goaUF0dHJzLnZhbHVlLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFZhbHVlICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZ09wdGlvbi52YWx1ZSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goaUF0dHJzLmxhYmVsLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFZhbHVlICYmIG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZ09wdGlvbi5sYWJlbCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLmNsZWFyVmFsdWUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHRyYW5zY2x1ZGVGbihmdW5jdGlvbiAoY2xvbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpRWxtLmFwcGVuZChjbG9uZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSk7XHJcbn0pO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
