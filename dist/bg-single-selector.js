define(["angular"],function(e){var t=e.module("bg.selector",[]);t.directive("bgSelector",["$document","$parse",function(t,l){var n=function(e,t){t=t||[];for(var l=t.length,n=0;l>n;n++){var o=t[n];if(o===e)return!0}return!1};return{scope:{},controller:["$scope","$element","$attrs","$transclude",function(e,t,l,n){var o=this;o.options=[],o.open=!1,o.hideChoiceList=function(){o.open=!1},o.toggleChoiceList=function(){o.open=!o.open},o.setSelectorLabel=function(e){o.label=e},o.addOption=function(e){o.options.push(e)}}],controllerAs:"selector",require:["bgSelector","ngModel"],restrict:"E",template:function(e,t){t.ngModel;return'<div class="bg-selector-container"><div class="bg-selector-bar"><div class="bg-selector-content" ng-bind-template="{{selector.label}}"></div><div class="bg-selector-icon" ng-class="{true: \'open\'}[selector.open]"></div></div><div class="bg-choice-list" ng-show="selector.open"></div></div>'},replace:!0,transclude:!0,link:function(o,c,i,r,a){var s=r[0],u=r[1],d=i.placeholder||"请选择",p=e.element(c[0].querySelector(".bg-choice-list")),b=e.element(c[0].querySelector(".bg-selector-bar"));s.onSelectCallback=l(i.onSelect)(o),b.bind("click",function(e){s.toggleChoiceList(),o.$apply(),e.stopPropagation()}),t.bind("click",function(e){s.open&&s.hideChoiceList(),o.$apply()}),o.$parent.$watch(i.ngModel,function(e){n(e,s.options)?o.$broadcast("bgs:change",e):s.setSelectorLabel(d)}),s.setValue=function(e,t){u.$setViewValue(e),s.setSelectorLabel(t)},s.getValue=function(){return u.$modelValue},a(function(e){p.append(e)}),s.setSelectorLabel(d)}}}]),t.directive("bgOption",["$parse",function(e){return{priority:-1,controller:["$scope","$element","$attrs","$transclude",function(t,l,n,o){var c=this;c.value=e(n.value)(t),c.label=e(n.label)(t)}],controllerAs:"option",require:["bgOption","^bgSelector"],restrict:"E",template:'<div class="bg-selector-choice"></div>',replace:!0,transclude:!0,link:function(e,t,l,n,o){var c=n[0],i=n[1];t.bind("click",function(){var e=c.value,t=c.label;t||(e="请选择"),i.setValue(e,t),i.hideChoiceList(),i.onSelectCallback&&i.onSelectCallback(e,t)}),c.value===i.getValue()&&i.setSelectorLabel(c.label),e.$on("bgs:change",function(e,t){t===c.value&&i.setSelectorLabel(c.label)}),i.addOption(c.value),o(function(e){t.append(e)})}}}])});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJnLXNpbmdsZS1zZWxlY3Rvci5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJhbmd1bGFyIiwiYmdzIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiJGRvY3VtZW50IiwiJHBhcnNlIiwiaXNFeGlzdCIsInZhbHVlIiwib3B0aW9ucyIsImxlbmd0aCIsImkiLCJ0ZW1wIiwic2NvcGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkdHJhbnNjbHVkZSIsImN0cmwiLCJ0aGlzIiwib3BlbiIsImhpZGVDaG9pY2VMaXN0IiwidG9nZ2xlQ2hvaWNlTGlzdCIsInNldFNlbGVjdG9yTGFiZWwiLCJsYWJlbCIsImFkZE9wdGlvbiIsInB1c2giLCJjb250cm9sbGVyQXMiLCJyZXF1aXJlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZSIsImlFbG0iLCJpQXR0cnMiLCJuZ01vZGVsIiwicmVwbGFjZSIsInRyYW5zY2x1ZGUiLCJsaW5rIiwiY3RybHMiLCJ0cmFuc2NsdWRlRm4iLCJzZWxlY3RvciIsInBsYWNlaG9sZGVyIiwiY2hvaWNlTGlzdCIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2VsZWN0b3JCYXIiLCJvblNlbGVjdENhbGxiYWNrIiwib25TZWxlY3QiLCJiaW5kIiwiZSIsIiRhcHBseSIsInN0b3BQcm9wYWdhdGlvbiIsIiRwYXJlbnQiLCIkd2F0Y2giLCIkYnJvYWRjYXN0Iiwic2V0VmFsdWUiLCIkc2V0Vmlld1ZhbHVlIiwiZ2V0VmFsdWUiLCIkbW9kZWxWYWx1ZSIsImNsb25lIiwiYXBwZW5kIiwicHJpb3JpdHkiLCJiZ09wdGlvbiIsImJnU2VsZWN0b3IiLCIkb24iLCJldmVudCJdLCJtYXBwaW5ncyI6IkFBS0FBLFFBQVEsV0FBWSxTQUFVQyxHQUMxQixHQUFJQyxHQUFNRCxFQUFRRSxPQUFPLGlCQUV6QkQsR0FBSUUsVUFBVSxjQUFlLFlBQWEsU0FBVSxTQUFVQyxFQUFXQyxHQVNyRSxHQUFJQyxHQUFVLFNBQVVDLEVBQU9D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LEVBQVd2QyxpQkFBaUJzQyxFQUFTckMsT0FJekNWLEVBQU9pRCxJQUFJLGFBQWMsU0FBVUMsRUFBT3pELEdBQ2xDQSxJQUFVc0QsRUFBU3RELE9BQ25CdUQsRUFBV3ZDLGlCQUFpQnNDLEVBQVNyQyxTQUc3Q3NDLEVBQVdyQyxVQUFVb0MsRUFBU3RELE9BQzlCK0IsRUFBYSxTQUFVb0IsR0FDbkIzQixFQUFLNEIsT0FBT0QiLCJmaWxlIjoiYmctc2luZ2xlLXNlbGVjdG9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBmaWxlIOWNlemAieS4i+aLieahhue7hOS7tlxyXG4gKiBAYXV0aG9yIGxha2IyNDhAZ21haWwuY29tXHJcbiAqL1xyXG5cclxuZGVmaW5lKFsnYW5ndWxhciddLCBmdW5jdGlvbiAoYW5ndWxhcikge1xyXG4gICAgdmFyIGJncyA9IGFuZ3VsYXIubW9kdWxlKCdiZy5zZWxlY3RvcicsIFtdKTtcclxuXHJcbiAgICBiZ3MuZGlyZWN0aXZlKCdiZ1NlbGVjdG9yJywgWyckZG9jdW1lbnQnLCAnJHBhcnNlJywgZnVuY3Rpb24gKCRkb2N1bWVudCwgJHBhcnNlKSB7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIHdoZXRoZXIgdGhlIHZhbHVlIGV4aXN0IGluIHRoZSBvcHRpb25zXHJcbiAgICAgICAgICogQGF1dGhvciBsYWtiMjQ4QGdtYWlsLmNvbVxyXG4gICAgICAgICAqIEBwYXJhbSAge3N0cmluZ30gIHZhbHVlICAgdGhlIHZhbHVlXHJcbiAgICAgICAgICogQHBhcmFtICB7c3RyaW5nfSAgb3B0aW9ucyB0aGUgb3B0aW9uc1xyXG4gICAgICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IHJldHVsdCAgdGhlIHJlc3VsdFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBpc0V4aXN0ID0gZnVuY3Rpb24gKHZhbHVlLCBvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IFtdO1xyXG4gICAgICAgICAgICB2YXIgbGVuZ3RoID0gb3B0aW9ucy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IG9wdGlvbnNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAodGVtcCA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyBSdW5zIGR1cmluZyBjb21waWxlXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2NvcGU6IHt9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBbXHJcbiAgICAgICAgICAgICAgICAnJHNjb3BlJywgJyRlbGVtZW50JywgJyRhdHRycycsICckdHJhbnNjbHVkZScsXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoJHNjb3BlLCAkZWxlbWVudCwgJGF0dHJzLCAkdHJhbnNjbHVkZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdHJsID0gdGhpcztcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLm9wdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLm9wZW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIGNob2ljZSBsaXN0XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5oaWRlQ2hvaWNlTGlzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3RybC5vcGVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0b2dnbGUgdGhlIHN0YXR1cyBvZiBjaG9pY2UgbGlzdFxyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwudG9nZ2xlQ2hvaWNlTGlzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3RybC5vcGVuID0gIWN0cmwub3BlbjtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgbGFiZWwgb2Ygc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLnNldFNlbGVjdG9yTGFiZWwgPSBmdW5jdGlvbiAobGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3RybC5sYWJlbCA9IGxhYmVsO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC5hZGRPcHRpb24gPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3RybC5vcHRpb25zLnB1c2godmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAnc2VsZWN0b3InLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJ2JnU2VsZWN0b3InLCAnbmdNb2RlbCddLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogZnVuY3Rpb24gKGlFbG0sIGlBdHRycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGVsTmFtZSA9IGlBdHRycy5uZ01vZGVsO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiYmctc2VsZWN0b3ItY29udGFpbmVyXCI+J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICArICc8ZGl2IGNsYXNzPVwiYmctc2VsZWN0b3ItYmFyXCI+J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWNvbnRlbnRcIiBuZy1iaW5kLXRlbXBsYXRlPVwie3tzZWxlY3Rvci5sYWJlbH19XCI+PC9kaXY+J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImJnLXNlbGVjdG9yLWljb25cIiBuZy1jbGFzcz1cInt0cnVlOiBcXCdvcGVuXFwnfVtzZWxlY3Rvci5vcGVuXVwiPjwvZGl2PidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPC9kaXY+J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICArICc8ZGl2IGNsYXNzPVwiYmctY2hvaWNlLWxpc3RcIiBuZy1zaG93PVwic2VsZWN0b3Iub3BlblwiPidcclxuICAgICAgICAgICAgICAgICAgICAgICAgKyAnPC9kaXY+J1xyXG4gICAgICAgICAgICAgICAgICAgICsgJzwvZGl2Pic7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsIGlFbG0sIGlBdHRycywgY3RybHMsIHRyYW5zY2x1ZGVGbikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gY3RybHNbMF07XHJcbiAgICAgICAgICAgICAgICB2YXIgbmdNb2RlbCA9IGN0cmxzWzFdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBsYWNlaG9sZGVyID0gaUF0dHJzLnBsYWNlaG9sZGVyIHx8ICfor7fpgInmi6knO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNob2ljZUxpc3QgPSBhbmd1bGFyLmVsZW1lbnQoaUVsbVswXS5xdWVyeVNlbGVjdG9yKCcuYmctY2hvaWNlLWxpc3QnKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0b3JCYXIgPSBhbmd1bGFyLmVsZW1lbnQoaUVsbVswXS5xdWVyeVNlbGVjdG9yKCcuYmctc2VsZWN0b3ItYmFyJykpO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3Iub25TZWxlY3RDYWxsYmFjayA9ICRwYXJzZShpQXR0cnMub25TZWxlY3QpKCRzY29wZSk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RvckJhci5iaW5kKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3IudG9nZ2xlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvLyBiaW5kIGNsaWNrIGV2ZW50IHRvIGhpZGUgdGhlIGNob2ljZSBsaXN0IHdoZW4gZG9jdW1lbnQgY2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgJGRvY3VtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3Iub3Blbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvci5oaWRlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIC8vIHdhdGNoIG5nTW9kZWwgdG8gc2V0IHRoZSBsYWJlbFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQuJHdhdGNoKGlBdHRycy5uZ01vZGVsLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCB0aGUgc2VsZWN0b3JcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRXhpc3QodmFsdWUsIHNlbGVjdG9yLm9wdGlvbnMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdiZ3M6Y2hhbmdlJywgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFZhbHVlID0gZnVuY3Rpb24gKHZhbHVlLCBsYWJlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChsYWJlbCk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3IuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5nTW9kZWwuJG1vZGVsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIHRyYW5zY2x1ZGVGbihmdW5jdGlvbiAoY2xvbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaG9pY2VMaXN0LmFwcGVuZChjbG9uZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yLnNldFNlbGVjdG9yTGFiZWwocGxhY2Vob2xkZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1dKTtcclxuXHJcbiAgICBiZ3MuZGlyZWN0aXZlKCdiZ09wdGlvbicsIFsnJHBhcnNlJywgZnVuY3Rpb24gKCRwYXJzZSkge1xyXG4gICAgICAgIC8vIFJ1bnMgZHVyaW5nIGNvbXBpbGVcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwcmlvcml0eTogLTEsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFtcclxuICAgICAgICAgICAgICAgICckc2NvcGUnLCAnJGVsZW1lbnQnLCAnJGF0dHJzJywgJyR0cmFuc2NsdWRlJyxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsICR0cmFuc2NsdWRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN0cmwgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwudmFsdWUgPSAkcGFyc2UoJGF0dHJzLnZhbHVlKSgkc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwubGFiZWwgPSAkcGFyc2UoJGF0dHJzLmxhYmVsKSgkc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ29wdGlvbicsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFsnYmdPcHRpb24nLCAnXmJnU2VsZWN0b3InXSxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwiYmctc2VsZWN0b3ItY2hvaWNlXCI+PC9kaXY+JyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgaUVsbSwgaUF0dHJzLCBjdHJscywgdHJhbnNjbHVkZUZuKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmdPcHRpb24gPSBjdHJsc1swXTtcclxuICAgICAgICAgICAgICAgIHZhciBiZ1NlbGVjdG9yID0gY3RybHNbMV07XHJcbiAgICAgICAgICAgICAgICBpRWxtLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJnT3B0aW9uLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IGJnT3B0aW9uLmxhYmVsO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghbGFiZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAn6K+36YCJ5oupJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSB2YWx1ZSBhbmQgbGFiZWwgb2YgdGhlIHNlbGVjdG9yIHdoZW4gb3B0aW9uIGNsaWNrZWRcclxuICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLnNldFZhbHVlKHZhbHVlLCBsYWJlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5oaWRlQ2hvaWNlTGlzdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRyaWdnZXIgdGhlIGNhbGxiYWNrXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJnU2VsZWN0b3Iub25TZWxlY3RDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLm9uU2VsZWN0Q2FsbGJhY2sodmFsdWUsIGxhYmVsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGlmIChiZ09wdGlvbi52YWx1ZSA9PT0gYmdTZWxlY3Rvci5nZXRWYWx1ZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmdTZWxlY3Rvci5zZXRTZWxlY3RvckxhYmVsKGJnT3B0aW9uLmxhYmVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBsaXN0ZW4gdG8gdGhlIGNoYW5nZSBldmVudCB0byBzZXQgdGhlIGxhYmVsIG9mIHRoZSBzZWxlY3RvclxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRvbignYmdzOmNoYW5nZScsIGZ1bmN0aW9uIChldmVudCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IGJnT3B0aW9uLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJnU2VsZWN0b3Iuc2V0U2VsZWN0b3JMYWJlbChiZ09wdGlvbi5sYWJlbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBiZ1NlbGVjdG9yLmFkZE9wdGlvbihiZ09wdGlvbi52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB0cmFuc2NsdWRlRm4oZnVuY3Rpb24gKGNsb25lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaUVsbS5hcHBlbmQoY2xvbmUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pO1xyXG59KTtcclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
